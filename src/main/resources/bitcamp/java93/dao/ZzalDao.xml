<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitcamp.java93.dao.ZzalDao">
  
  <resultMap type="zzal" id="zzalMap">
    <id column="zzno" property="zzno"/>
    <result column="mno" property="mno"/>
    <result column="cno" property="cno"/>
    <result column="titl" property="title"/>
    <result column="pic2" property="mainPic"/>
    <result column="cdt" property="cdt"/>
    <result column="ztmp" property="zzalTemporary"/>
    <result column="like_cnt" property="likeCount"/>
    <result column="reply_cnt" property="replyCount"/>
    <association property="member" javaType="Member">
	    <id column="mno" property="no"/>
	    <result column="nick" property="nick"/>
	    <result column="email" property="email"/>
	    <result column="pwd" property="password"/>
	    <result column="mtype" property="membtype"/>
	    <result column="stype" property="signtype"/>
	    <result column="pic1" property="membpic"/>
	  </association>
  </resultMap>
  
  <sql id="select1">
    select zzno, mno, cno, titl, zpic, cdt
    from zzal_lect
  </sql>

	<select id="selectList" resultMap="zzalMap" parameterType="int">
    select z.zzno, z.mno, m.nick, z.cno, z.titl, z.zpic, z.cdt
    from zzal_lect z inner join memb m on z.mno = m.mno
    where z.zzno = #{no} 
  </select>

  <select id="zzalListWithCount" resultMap="zzalMap" parameterType="map">
    select z.zzno, z.mno, m.nick, m.pic as pic1, z.cno, z.titl, z.pic as pic2, z.cdt,
    (select count(*) from lik where zzno=z.zzno) as like_cnt, 
    (select count(*) from reply where zzno=z.zzno) as reply_cnt
    from zzal_lect z inner join memb m on z.mno = m.mno
    where z.ztmp=true
    order by like_cnt + reply_cnt desc
  </select>
  
  <select id="countAll" resultType="int">
    select count(*)
    from zzal_lect
  </select>
  
</mapper> 




